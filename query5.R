q5 <- sqldf(c("      CREATE TEMP TABLE timeline As        SELECT          FirstName,          HireDate As changeDate,          1 As event,          HireDate,          CASE             WHEN TerminationDate IS NULL THEN DATE('now')              ELSE TerminationDate          END As TerminationDate        FROM Employee        UNION ALL        SELECT          FirstName,          CASE             WHEN TerminationDate IS NULL THEN DATE('now')            ELSE TerminationDate          END As changeDate,          -1 As event,          HireDate,          CASE             WHEN TerminationDate IS NULL THEN DATE('now')              ELSE TerminationDate          END As TerminationDate        FROM Employee        ORDER BY HireDate      ",       "      SELECT        FirstName,        cumulative_count,        min(changedate) As changedate__Date      FROM(          SELECT             FirstName,            changedate,            cumulative_count          FROM              (              SELECT              b.FirstName,              a.changedate,              a.cumulative_count,              a.changedate >= b.HireDate AND a.changedate <= b.TerminationDate As included              FROM                   (                  SELECT                   a.FirstName,                   a.changeDate,                   a.event,                  a.HireDate,                  a.TerminationDate,                  SUM(b.event) As cumulative_count                  FROM timeline As a, timeline As b                  WHERE a.changeDate >= b.changeDate                  GROUP BY a.FirstName, a.changeDate, a.event                  ORDER BY a.changeDate) As a                 JOIN                   (                  SELECT                   a.FirstName,                   a.changeDate,                   a.event,                  a.HireDate,                  a.TerminationDate,                  SUM(b.event) As cumulative_count                  FROM timeline As a, timeline As b                  WHERE a.changeDate >= b.changeDate                  GROUP BY a.FirstName, a.changeDate, a.event                  ORDER BY a.changeDate) As b                  ) As t1            WHERE               included = 1 AND              cumulative_count = (                                  SELECT MAX(cumulative_count)                                   FROM (                                        SELECT                                        b.FirstName,                                        a.changedate,                                        a.cumulative_count,                                        a.changedate >= b.HireDate AND a.changedate <= b.TerminationDate As included                                        FROM (                                              SELECT                                                 a.FirstName,                                                 a.changeDate,                                                 a.event,                                                a.HireDate,                                                a.TerminationDate,                                                SUM(b.event) As cumulative_count                                              FROM timeline As a, timeline As b                                              WHERE a.changeDate >= b.changeDate                                              GROUP BY a.FirstName, a.changeDate, a.event                                              ORDER BY a.changeDate                                        ) As a                                           JOIN (                                              SELECT                                                 a.FirstName,                                                 a.changeDate,                                                 a.event,                                                a.HireDate,                                                a.TerminationDate,                                                SUM(b.event) As cumulative_count                                              FROM timeline As a, timeline As b                                              WHERE a.changeDate >= b.changeDate                                              GROUP BY a.FirstName, a.changeDate, a.event                                              ORDER BY a.changeDate                                              ) As b                                  )                                  WHERE FirstName = t1.FirstName                                  )              GROUP BY FirstName, changedate, cumulative_count, included              ORDER BY FirstName        )      GROUP BY        FirstName,        cumulative_count"), method = "name__class")